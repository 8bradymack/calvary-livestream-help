<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calvary Livestream Troubleshooting</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif; background-color: #f5f5f5; color: #333; line-height: 1.6; padding-bottom: 60px; }
        header { background: linear-gradient(135deg, #1e3a8a 0%, #3b82f6 100%); color: white; padding: 20px 20px 30px; text-align: center; box-shadow: 0 2px 10px rgba(0,0,0,0.1); }
        h1 { font-size: 1.8em; margin-bottom: 5px; font-weight: 600; }
        .subtitle { font-size: 0.95em; opacity: 0.9; margin-bottom: 20px; }
        .search-container { max-width: 600px; margin: -20px auto 0; padding: 0 20px; position: relative; z-index: 10; }
        #searchBar { width: 100%; padding: 16px 50px 16px 20px; font-size: 1.1em; border: none; border-radius: 12px; box-shadow: 0 4px 20px rgba(0,0,0,0.15); outline: none; transition: box-shadow 0.3s; }
        #searchBar::placeholder { color: #999; }
        #searchBar:focus { box-shadow: 0 6px 30px rgba(59,130,246,0.3); }
        .search-icons-container { position: absolute; right: 35px; top: 50%; transform: translateY(-50%); }
        .search-icon { color: #999; font-size: 1.3em; cursor: default; }
        .clear-search { color: white; font-size: 1.1em; cursor: pointer; background: rgba(255,255,255,0.2); border-radius: 50%; width: 24px; height: 24px; display: none; align-items: center; justify-content: center; transition: all 0.2s; font-weight: bold; }
        .clear-search:hover { background: rgba(255,255,255,0.3); }
        .clear-search.active { display: flex; }
        .suggestions-dropdown { position: absolute; top: 100%; left: 20px; right: 20px; background: white; border-radius: 12px; box-shadow: 0 8px 24px rgba(0,0,0,0.2); margin-top: 8px; max-height: 400px; overflow-y: auto; display: none; z-index: 100; }
        .suggestions-dropdown.active { display: block; }
        .suggestion-item { padding: 12px 20px; cursor: pointer; border-bottom: 1px solid #f0f0f0; transition: background 0.2s; }
        .suggestion-item:hover { background: #f8fafc; }
        .suggestion-item:last-child { border-bottom: none; }
        .suggestion-question { font-weight: 600; color: #1e3a8a; font-size: 0.95em; margin-bottom: 4px; }
        .suggestion-preview { font-size: 0.85em; color: #666; }
        .suggestion-category { display: inline-block; padding: 2px 8px; background: #e0f2fe; color: #0369a1; border-radius: 8px; font-size: 0.7em; font-weight: 600; margin-top: 4px; }
        .highlight { background: #fef3c7; padding: 2px 4px; border-radius: 2px; font-weight: 600; }
        .search-stats { text-align: center; color: #666; font-size: 0.9em; margin: 20px 0 10px; }
        .recent-searches { max-width: 600px; margin: 15px auto 0; padding: 0 20px; }
        .recent-searches-title { font-size: 0.85em; color: rgba(255,255,255,0.85); margin-bottom: 8px; font-weight: 600; }
        .recent-tag { display: inline-block; padding: 6px 12px; background: white; border: 1px solid #e5e7eb; border-radius: 16px; font-size: 0.85em; margin: 4px; cursor: pointer; transition: all 0.2s; color: #666; }
        .recent-tag:hover { border-color: #3b82f6; color: #3b82f6; transform: translateY(-1px); background: #f8fafc; }
        .clear-recent { display: inline-block; padding: 6px 12px; background: transparent; border: none; color: rgba(255,255,255,0.7); font-size: 0.85em; cursor: pointer; margin-left: 8px; }
        .clear-recent:hover { color: white; }
        .container { max-width: 800px; margin: 30px auto; padding: 0 20px; }
        .categories { display: flex; gap: 10px; flex-wrap: wrap; margin-bottom: 30px; justify-content: center; }
        .category-btn { padding: 10px 20px; background: white; border: 2px solid #e5e7eb; border-radius: 25px; cursor: pointer; font-size: 0.95em; transition: all 0.3s; color: #666; font-weight: 500; }
        .category-btn:hover { border-color: #3b82f6; color: #3b82f6; transform: translateY(-2px); }
        .category-btn.active { background: #3b82f6; color: white; border-color: #3b82f6; }
        .faq-list { display: flex; flex-direction: column; gap: 15px; }
        .faq-item { background: white; border-radius: 12px; padding: 20px; box-shadow: 0 2px 8px rgba(0,0,0,0.08); cursor: pointer; transition: all 0.3s; border: 2px solid transparent; }
        .faq-item:hover { box-shadow: 0 4px 16px rgba(0,0,0,0.12); transform: translateY(-2px); border-color: #3b82f6; }
        .faq-item.pinned { border-left: 4px solid #f59e0b; }
        .faq-question { font-size: 1.15em; font-weight: 600; color: #1e3a8a; margin-bottom: 5px; display: flex; justify-content: space-between; align-items: center; }
        .faq-category { display: inline-block; padding: 4px 12px; background: #e0f2fe; color: #0369a1; border-radius: 12px; font-size: 0.75em; font-weight: 600; margin-top: 8px; }
        .faq-preview { color: #666; font-size: 0.95em; margin-top: 8px; line-height: 1.5; }
        .faq-item.expanded .faq-preview { display: none; }
        .faq-answer { margin-top: 15px; padding-top: 15px; border-top: 1px solid #e5e7eb; color: #444; line-height: 1.7; display: none; }
        .faq-answer.expanded { display: block; }
        .faq-answer h3 { color: #1e3a8a; font-size: 1.05em; margin-top: 15px; margin-bottom: 8px; }
        .faq-answer ul, .faq-answer ol { margin-left: 20px; margin-top: 8px; }
        .faq-answer li { margin-bottom: 6px; }
        .faq-answer strong { color: #1e3a8a; }
        .expand-icon { color: #3b82f6; font-size: 1.2em; transition: transform 0.3s; }
        .faq-item.expanded .expand-icon { transform: rotate(180deg); }
        .section-title { font-size: 1.3em; font-weight: 600; color: #1e3a8a; margin-bottom: 15px; display: flex; align-items: center; gap: 8px; }
        .pinned-section { margin-bottom: 40px; }
        .pin-icon { color: #f59e0b; }
        .no-results { text-align: center; padding: 60px 20px; color: #666; display: none; }
        .no-results-icon { font-size: 3em; margin-bottom: 15px; opacity: 0.5; }
        .no-results h2 { font-size: 1.5em; margin-bottom: 10px; color: #444; }
        footer { text-align: center; padding: 30px 20px; color: #666; font-size: 0.9em; background: white; margin-top: 50px; box-shadow: 0 -2px 10px rgba(0,0,0,0.05); }
        .report-btn { display: inline-block; margin-top: 15px; padding: 12px 30px; background: #3b82f6; color: white; text-decoration: none; border-radius: 8px; font-weight: 600; transition: all 0.3s; }
        .report-btn:hover { background: #2563eb; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(59,130,246,0.3); }
    </style>
</head>
<body>
    <header>
        <h1>üé• Calvary Livestream Troubleshooting</h1>
        <p class="subtitle">Quick solutions for common livestream issues</p>
        <div class="search-container">
            <input type="text" id="searchBar" placeholder="Search: 'no sound', 'camera dark', 'deck broken'..." autocomplete="off">
            <div class="search-icons-container">
                <span class="search-icon" id="searchIcon">üîç</span>
                <span class="clear-search" id="clearSearch">‚úï</span>
            </div>
            <div class="suggestions-dropdown" id="suggestionsDropdown"></div>
        </div>
        <div class="recent-searches" id="recentSearches" style="display:none;">
            <div class="recent-searches-title">Recent searches:</div>
            <div id="recentTags"></div>
        </div>
    </header>

    <div class="container">
        <div class="search-stats" id="searchStats"></div>
        
        <div class="categories" id="categories">
            <button class="category-btn active" data-category="all">All</button>
            <button class="category-btn" data-category="Setup/Shutdown">Setup/Shutdown</button>
            <button class="category-btn" data-category="Video">Video</button>
            <button class="category-btn" data-category="Audio">Audio</button>
            <button class="category-btn" data-category="Networking">Networking</button>
            <button class="category-btn" data-category="Stream Deck">Stream Deck</button>
            <button class="category-btn" data-category="Software">Software</button>
        </div>

        <div class="pinned-section" id="pinnedSection">
            <h2 class="section-title"><span class="pin-icon">üìå</span>Most Common Issues</h2>
            <div class="faq-list" id="pinnedList"></div>
        </div>

        <div id="allSection">
            <h2 class="section-title">All Troubleshooting Guides</h2>
            <div class="faq-list" id="faqList"></div>
        </div>

        <div class="no-results" id="noResults">
            <div class="no-results-icon">üîç</div>
            <h2>No matches found</h2>
            <p>Try different keywords</p>
        </div>
    </div>

    <footer>
        <p><strong>Last Updated:</strong> October 2025</p>
        <p>Calvary San Mateo A/V Team</p>
        <a href="#" id="reportBtn" class="report-btn">üìß Report an Issue</a>
    </footer>

    <div id="contactModal" style="display:none;position:fixed;top:0;left:0;width:100%;height:100%;background:rgba(0,0,0,0.6);z-index:1000;padding:20px;">
        <div style="max-width:600px;margin:50px auto;background:white;border-radius:12px;padding:30px;">
            <h2 style="color:#1e3a8a;margin-bottom:10px;">Report an Issue</h2>
            <form id="contactForm" action="https://formspree.io/f/xqayyzrr" method="POST">
                <div style="margin-bottom:20px;">
                    <label style="display:block;font-weight:600;margin-bottom:8px;">Your Name (Optional)</label>
                    <input type="text" name="name" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;">
                </div>
                <div style="margin-bottom:20px;">
                    <label style="display:block;font-weight:600;margin-bottom:8px;">Issue Category</label>
                    <select name="category" style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;background:white;">
                        <option value="">Select...</option>
                        <option>Setup/Shutdown</option>
                        <option>Video</option>
                        <option>Audio</option>
                        <option>Networking</option>
                        <option>Stream Deck</option>
                        <option>Software</option>
                        <option>Other</option>
                    </select>
                </div>
                <div style="margin-bottom:25px;">
                    <label style="display:block;font-weight:600;margin-bottom:8px;">Description *</label>
                    <textarea name="message" required style="width:100%;padding:12px;border:2px solid #e5e7eb;border-radius:8px;min-height:150px;"></textarea>
                </div>
                <div style="display:flex;gap:10px;justify-content:flex-end;">
                    <button type="button" id="cancelBtn" style="padding:12px 24px;background:#e5e7eb;border:none;border-radius:8px;cursor:pointer;">Cancel</button>
                    <button type="submit" style="padding:12px 24px;background:#3b82f6;color:white;border:none;border-radius:8px;cursor:pointer;">Submit</button>
                </div>
            </form>
            <div id="successMessage" style="display:none;margin-top:20px;padding:15px;background:#d1fae5;border-radius:8px;">‚úì Submitted!</div>
        </div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.6.2/fuse.min.js"></script>
    <script>
const faqData=[
{id:1,question:"Complete Startup Procedure",category:"Setup/Shutdown",pinned:true,keywords:"startup start screw power cable",answer:"<h3>Step-by-Step:</h3><ol><li>Turn on ATEM first (screw in power cable)</li><li>Turn on Cameras (flip power strips ON on top of cameras)</li><li>Turn on MacBook (open lid and log in)</li><li>Check Monitors (If Dell and LG don't auto-turn on, click power buttons on bottom right)</li><li>Launch Companion</li><li>Setup QuickTime (New Movie Recording ‚Üí Input: Blackmagic Design ‚Üí Drag to LG ‚Üí Fullscreen)</li><li>Adjust Camera Brightness (ATEM Software ‚Üí Camera ‚Üí Adjust Aperture ‚Üí Gain +14dB)</li><li>Check Audio (Press MIC1 ON ‚Üí Target: right between green and yellow)</li></ol>"},
{id:2,question:"Complete Shutdown Procedure",category:"Setup/Shutdown",pinned:true,keywords:"shutdown black cloths",answer:"<h3>Step-by-Step:</h3><ol><li>Switch HDMI switch to Input 2 (press SWITCH button)</li><li>Shut down MacBook</li><li>Turn off cameras (both power strips OFF)</li><li>Turn off monitors (press power buttons on bottom right)</li><li>Unplug ATEM last (unscrew power cable)</li><li>Cover equipment (black cloths)</li></ol>"},
{id:3,question:"Cameras look dark or dim",category:"Video",pinned:true,keywords:"dark dim brightness aperture gain",answer:"<h3>Fix Dark Cameras:</h3><ol><li>Open ATEM Software Control</li><li>Go to Camera page</li><li>Drag Aperture to top center</li><li>Set Gain to +14dB</li><li>Adjust until good</li></ol>"},
{id:4,question:"No sound on livestream",category:"Audio",pinned:true,keywords:"no sound audio muted x32 matrix 3.5mm cable green yellow",answer:"<h3>Fix No Audio:</h3><ol><li>Check X32 Matrix NOT muted (ask audio engineer)</li><li>Press MIC1 ON on ATEM (always muted after restart!)</li><li>Check Dell monitor audio bars</li><li>Target: right between green and yellow</li></ol><h3>If still no audio:</h3><ul><li>Check volume arrows under MIC1</li><li>Check 3.5mm audio cable plugged into back left of ATEM</li></ul>"},
{id:5,question:"Restream freezing or disconnecting",category:"Networking",pinned:true,keywords:"restream freezing glitch lag ethernet quicktime recording",answer:"<h3>Fix Restream Freezing:</h3><ol><li><strong>FIRST:</strong> Start recording the stream on QuickTime</li><li>Check internet</li><li>Verify Ethernet (BLUE light on dock)</li><li>Check Dell shows ON AIR + DATA RATE</li><li>Refresh Restream page</li><li>Try Safari instead of Chrome</li></ol><h3>If still freezing:</h3><ul><li>Check ATEM cache</li><li>Unplug and plug back in ethernet on back of ATEM</li></ul>"},
{id:6,question:"ATEM cache filling up or FULL",category:"Networking",pinned:true,keywords:"cache full buffer ethernet quicktime recording sermon",answer:"<h3>‚ö†Ô∏è FIRST: Start recording stream on QuickTime</h3><h3>FIX 1 (Try First):</h3><ol><li>Unplug Ethernet from ATEM back</li><li>Plug back in</li><li>Press MIC1 ON</li></ol><h3>FIX 2 (If not during sermon):</h3><ol><li>Power cycle ATEM (stops video!)</li><li>Wait 5 seconds</li><li>Plug back in</li><li>Press MIC1 ON</li></ol>"},
{id:7,question:"Stream Deck not working",category:"Stream Deck",pinned:true,keywords:"stream deck companion toggle atem",answer:"<h3>FIX 1: Restart Companion</h3><ol><li>Quit Companion</li><li>Reopen</li><li>Test buttons</li></ol><h3>FIX 2 (MOST COMMON):</h3><ol><li>Click Companion in menu bar</li><li>Launch GUI</li><li>Find ATEM connection</li><li>Toggle OFF then ON</li></ol><h3>FIX 3: Hardware</h3><ul><li>Check dock BLUE light</li><li>Check USB plugged in</li></ul><h3>BACKUP:</h3><p>Use ATEM Software ‚Üí Macros</p>"},
{id:9,question:"QuickTime not showing video to TVs",category:"Software",pinned:false,keywords:"quicktime tv blackmagic usb-c",answer:"<h3>Setup QuickTime:</h3><ol><li>Launch QuickTime</li><li>File ‚Üí New Movie Recording</li><li>Click dropdown ‚Üí Choose Blackmagic Design</li><li>Drag to LG monitor</li><li>Click green fullscreen button</li></ol><h3>Troubleshooting:</h3><ul><li>No Blackmagic? Check ATEM powered on and USB-C connected from ATEM to computer</li><li>TVs black? Check HDMI extender/TV inputs</li></ul>"},
{id:12,question:"One TV has no signal (lobby OR patio)",category:"Video",pinned:false,keywords:"tv no signal hdmi input",answer:"<h3>Fix Single TV:</h3><ol><li>Check which HDMI port has cable (back of TV)</li><li>Press Input/Source on remote</li><li>Select matching HDMI (1, 2, or 3)</li><li>Wait a few seconds</li></ol><h3>If still no signal:</h3><ul><li>Check HDMI firmly plugged in</li><li>Power cycle HDMI extender</li></ul>"},
{id:13,question:"BOTH TVs have no signal",category:"Video",pinned:false,keywords:"both tvs hdmi extender flip switch lg monitor",answer:"<h3>Fix Both TVs:</h3><ol><li>Check dock light is BLUE</li><li>Check MacBook + QuickTime fullscreen</li><li>Check USB-C to HDMI adapter (left side)</li><li>Power cycle HDMI extender</li></ol><h3>HDMI Extender Reset:</h3><p><strong>‚ö†Ô∏è Will cut video for LG monitor and all TVs!</strong></p><ol><li>Flip switch off</li><li>Flip switch back on</li></ol>"},
{id:14,question:"Stream Deck completely off",category:"Stream Deck",pinned:false,keywords:"stream deck off dark anker dock power button",answer:"<h3>Fix Stream Deck:</h3><ol><li><strong>Check Anker dock light:</strong><ul><li>OFF = Click power button on front</li><li>GREEN = Fix USB-C from dock to MacBook Pro</li><li>BLUE = Good ‚úì</li></ul></li><li>If GREEN: Unplug/replug USB-C from MacBook</li><li>Check Stream Deck USB in dock</li><li>Launch Companion</li></ol><h3>Still dark?</h3><ul><li>Try different USB port</li><li>Restart Companion</li></ul>"},
{id:15,question:"Monitor won't turn on automatically",category:"Video",pinned:false,keywords:"monitor auto turn on dell lg shutdown",answer:"<h3>Manual Power On:</h3><p><strong>Dell Curved:</strong> Bottom far right button</p><p><strong>LG Flat:</strong> Bottom right button</p><p><strong>Note:</strong> This is NORMAL - monitors don't auto-turn on if manually turned off during last shutdown</p>"},
{id:16,question:"Docking station green or off",category:"Networking",pinned:false,keywords:"dock anker green off power button",answer:"<h3>If GREEN:</h3><ol><li>Unplug USB-C from MacBook</li><li>Wait 3 seconds</li><li>Replug firmly</li><li>Try other USB-C port</li><li>Should turn BLUE</li></ol><h3>If OFF:</h3><ol><li>Press power button on front of dock</li></ol><h3>Light meanings:</h3><ul><li>BLUE = Good</li><li>GREEN = Bad connection dock to MacBook Pro</li><li>OFF = Powered off or no power</li></ul>"},
{id:19,question:"Lyrics overlay not working",category:"Software",pinned:false,keywords:"lyrics propresenter displaylink launch order camera 4",answer:"<h3>‚ö†Ô∏è Launch Order Matters!</h3><p><strong>DisplayLink MUST launch BEFORE ProPresenter!</strong></p><h3>Fix Lyrics:</h3><ol><li>Quit ProPresenter</li><li>Quit DisplayLink</li><li>Wait 5 seconds</li><li><strong>Launch DisplayLink FIRST</strong></li><li><strong>Launch ProPresenter SECOND</strong></li><li>Check Camera 4</li></ol><p><strong>Why?</strong> DisplayLink creates virtual display. If launched second, ProPresenter can't find it.</p>"},
{id:20,question:"DisplayLink / Camera 4 issues",category:"Software",pinned:false,keywords:"displaylink camera 4 no signal desktop mac mini",answer:"<h3>If No Signal:</h3><ol><li>Launch DisplayLink Manager</li><li>Wait 10-15 seconds</li></ol><h3>If Shows Desktop:</h3><ol><li>Quit ProPresenter + DisplayLink</li><li>Launch DisplayLink FIRST</li><li>Launch ProPresenter SECOND</li></ol><h3>Still broken?</h3><ul><li>Check USB-C from Mac Mini</li><li>Restart both apps</li></ul>"},
{id:21,question:"ATEM not detected on QuickTime and/or ATEM Control app",category:"Video",pinned:false,keywords:"atem not detected quicktime software control sermon power cycle",answer:"<h3>Fix ATEM Not Found:</h3><ol><li>Check power cable (back right, screwed in)</li><li>Restart ATEM Software Control and/or QuickTime (the one not detecting ATEM)</li><li>Check USB/network cables</li><li><strong>Power cycle ATEM ONLY IF NOT DURING SERMON:</strong><ul><li>Unplug power</li><li>Wait 10 seconds</li><li>Plug back in</li><li>Restart software</li></ul></li></ol>"},
{id:24,question:"Restream not streaming to YouTube/Facebook",category:"Networking",pinned:false,keywords:"restream youtube facebook not streaming quicktime recording ethernet",answer:"<h3>‚ö†Ô∏è FIRST: Start recording in QuickTime</h3><h3>Fix Restream Not Live:</h3><ol><li>Quit Chrome</li><li>Open Safari</li><li>Go to Restream.io</li><li>Toggle YouTube/Facebook ON (green)</li><li>Check ATEM cache on Dell monitor</li></ol><h3>Still not streaming?</h3><ul><li>Check ON AIR button lit</li><li>Check Dell shows ON AIR</li><li>Check internet</li><li>Unplug ethernet on back of ATEM</li><li>Wait 5 seconds</li><li>Plug back in</li></ul>"},
{id:25,question:"ON AIR pressed but not streaming",category:"Networking",pinned:false,keywords:"on air not streaming obs ethernet cache",answer:"<h3>Fix ON AIR Not Streaming:</h3><ol><li>Check ATEM ON AIR lit (red)</li><li>Check Dell shows ON AIR in red</li><li>Open Restream.io</li><li>Click Connect to OBS</li><li>Toggle all platforms ON</li></ol><h3>If still not streaming:</h3><ul><li>Press OFF then ON AIR</li><li>Check Ethernet in dock (blue light)</li><li>Refresh Restream page</li><li>Check ATEM cache</li><li>Unplug ethernet on back of ATEM</li><li>Wait 5 seconds</li><li>Plug back in</li></ul>"},
{id:26,question:"Restream shows no camera signal",category:"Networking",pinned:false,keywords:"restream no signal black screen obs ethernet cache",answer:"<h3>Fix No Camera Signal:</h3><ol><li>Check ATEM ON AIR lit</li><li>Check Dell shows ON AIR</li><li>In Restream click Connect to OBS</li><li>Check Ethernet in dock (BLUE light)</li><li>Press OFF then ON AIR on ATEM</li></ol><h3>Still black?</h3><ul><li>Check which camera selected</li><li>Switch cameras and back</li><li>Check ATEM cache</li></ul>"}
];

const advancedSynonyms={
    audio:['sound','volume','mic','microphone','mute','muted','silent','quiet','hear','hearing','mics'],
    video:['picture','screen','display','visual','image','showing','feed','signal'],
    camera:['cam','cameras','cams'],
    dark:['dim','brightness','bright','light','lighting','exposure','black','too dark'],
    atem:['atm','switcher','mixer'],
    restream:['restram','streaming','stream','live','broadcast','broadcasting'],
    glitching:['glitch','freezing','frozen','lagging','lag','stuttering','choppy','buffering','cutting','cuts'],
    broke:['broken','not working','doesnt work','down','failed','failing','issue','problem','wont','cant','help'],
    startup:['start','starting','boot','booting','turn on','power on','setup','beginning'],
    shutdown:['shut down','turn off','power off','close','closing','ending','end'],
    tv:['television','tvs','monitor','screen','display','lobby','patio'],
    deck:['streamdeck','stream deck','elgato','buttons'],
    quicktime:['quick time','qt','recording','record'],
    macbook:['mac','laptop','computer'],
    ethernet:['internet','network','connection','wifi','online'],
    cache:['buffer','full','filling','storage'],
    lyrics:['propresenter','overlay','words','text','songs'],
    displaylink:['camera 4','cam 4','virtual'],
    dell:['curved'],
    lg:['flat'],
    dock:['anker','docking station','hub','usb'],
    green:['light','led','status'],
    blue:['light','led','status']
};

const problemPatterns = [
    {pattern: /no (sound|audio|voice|mic)/i, boost: ['audio', 'sound', 'muted', 'mic1']},
    {pattern: /(dark|dim|bright|black screen|too dark)/i, boost: ['camera', 'dark', 'brightness', 'aperture', 'gain']},
    {pattern: /(freez|lag|glitch|stutter|buffer|chop)/i, boost: ['restream', 'freezing', 'ethernet', 'cache', 'quicktime']},
    {pattern: /(not work|broken|doesn't|down|won't|can't|help|issue|problem)/i, boost: ['troubleshoot']},
    {pattern: /(tv|monitor|screen).*(no signal|black|blank|nothing)/i, boost: ['tv', 'signal', 'hdmi', 'input']},
    {pattern: /cache|full|buffer/i, boost: ['cache', 'full', 'ethernet', 'quicktime', 'recording']},
    {pattern: /deck|button/i, boost: ['stream deck', 'companion', 'toggle']},
    {pattern: /(start|boot|turn on|power on|setup|beginning)/i, boost: ['startup', 'procedure', 'complete']},
    {pattern: /(shut|turn off|close|end)/i, boost: ['shutdown', 'procedure', 'complete']},
    {pattern: /(youtube|facebook|social|platform)/i, boost: ['restream', 'streaming', 'not streaming']},
    {pattern: /on air|streaming|live/i, boost: ['on air', 'restream', 'obs']},
    {pattern: /lyric|propresenter|overlay|song|word/i, boost: ['lyrics', 'propresenter', 'displaylink', 'camera 4']},
    {pattern: /(camera 4|cam 4|displaylink)/i, boost: ['displaylink', 'propresenter', 'virtual']},
    {pattern: /(both|all|multiple).*(tv|monitor)/i, boost: ['both tvs', 'hdmi extender']},
    {pattern: /(one|single|lobby|patio).*(tv|monitor)/i, boost: ['one tv', 'single', 'input']},
    {pattern: /green|blue.*(light|dock)/i, boost: ['dock', 'anker', 'ethernet', 'usb']},
    {pattern: /detect|found|recognize|see/i, boost: ['atem', 'not detected', 'quicktime']},
    {pattern: /(quicktime|recording|record)/i, boost: ['quicktime', 'blackmagic', 'movie']},
    {pattern: /(internet|network|connection|ethernet|wifi)/i, boost: ['ethernet', 'network', 'dock', 'blue light']}
];

let recentSearches = [];
const MAX_RECENT = 5;

function loadRecentSearches() {
    const stored = {};
    if (stored.recentSearches) {
        recentSearches = stored.recentSearches;
    }
}

function saveRecentSearch(query) {
    if (!query || query.length < 2) return;
    query = query.trim().toLowerCase();
    recentSearches = recentSearches.filter(s => s !== query);
    recentSearches.unshift(query);
    recentSearches = recentSearches.slice(0, MAX_RECENT);
    renderRecentSearches();
}

function renderRecentSearches() {
    const container = document.getElementById('recentSearches');
    const tagsContainer = document.getElementById('recentTags');
    
    if (recentSearches.length === 0) {
        container.style.display = 'none';
        return;
    }
    
    container.style.display = 'block';
    tagsContainer.innerHTML = recentSearches.map(search => 
        `<span class="recent-tag" onclick="applyRecentSearch('${search}')">${search}</span>`
    ).join('') + '<button class="clear-recent" onclick="clearRecentSearches()">Clear</button>';
}

function applyRecentSearch(query) {
    document.getElementById('searchBar').value = query;
    currentSearch = query;
    renderAll();
}

function clearRecentSearches() {
    recentSearches = [];
    renderRecentSearches();
}

function expandSearchQuery(query) {
    let words = query.toLowerCase().split(/\s+/).filter(w => w.length > 0);
    
    // Remove common stop words
    const stopWords = ['a', 'an', 'the', 'or', 'and', 'on', 'in', 'at', 'to', 'for', 'of', 'is', 'are'];
    words = words.filter(w => !stopWords.includes(w) && w !== '/');
    
    let expanded = new Set(words);
    
    words.forEach(word => {
        if (advancedSynonyms[word]) {
            advancedSynonyms[word].forEach(syn => expanded.add(syn));
        }
        
        Object.keys(advancedSynonyms).forEach(key => {
            if (advancedSynonyms[key].includes(word)) {
                expanded.add(key);
                advancedSynonyms[key].forEach(syn => expanded.add(syn));
            }
        });
    });
    
    problemPatterns.forEach(({pattern, boost}) => {
        if (pattern.test(query)) {
            boost.forEach(term => expanded.add(term));
        }
    });
    
    return Array.from(expanded).join(' ');
}

function highlightText(text, searchTerms) {
    if (!searchTerms || searchTerms.length === 0) return text;
    
    // Filter out stop words from highlighting
    const stopWords = ['a', 'an', 'the', 'or', 'and', 'on', 'in', 'at', 'to', 'for', 'of', 'is', 'are'];
    const termsToHighlight = searchTerms.filter(term => !stopWords.includes(term.toLowerCase()) && term.length > 1);
    
    let result = text;
    termsToHighlight.forEach(term => {
        if (term.length < 2) return;
        const regex = new RegExp(`(${term})`, 'gi');
        result = result.replace(regex, '<span class="highlight">$1</span>');
    });
    return result;
}

function intelligentSearch(query) {
    if (!query) return faqData;
    
    const originalQuery = query;
    const expandedQuery = expandSearchQuery(query);
    
    // Remove stop words from search terms
    const stopWords = ['a', 'an', 'the', 'or', 'and', 'on', 'in', 'at', 'to', 'for', 'of', 'is', 'are'];
    const searchTerms = query.toLowerCase().split(/\s+/).filter(w => w.length > 1 && !stopWords.includes(w));
    
    const typoMap = {
        'atm': 'atem',
        'restram': 'restream',
        'restrem': 'restream',
        'cam': 'camera',
        'cams': 'camera',
        'mics': 'mic',
        'doesnt': 'doesn\'t',
        'wont': 'won\'t',
        'cant': 'can\'t',
        'youtube': 'restream youtube',
        'facebook': 'restream facebook',
        'fb': 'facebook',
        'yt': 'youtube'
    };
    
    let correctedQuery = query.toLowerCase();
    Object.keys(typoMap).forEach(typo => {
        correctedQuery = correctedQuery.replace(new RegExp('\\b' + typo + '\\b', 'g'), typoMap[typo]);
    });
    
    const fuse = new Fuse(faqData, {
        keys: [
            {name: 'question', weight: 0.45},
            {name: 'keywords', weight: 0.45},
            {name: 'answer', weight: 0.1}
        ],
        threshold: 0.45,
        includeScore: true,
        ignoreLocation: true,
        minMatchCharLength: 2,
        distance: 150,
        useExtendedSearch: true
    });
    
    let results = fuse.search(expandedQuery);
    
    if (results.length < 3) {
        const altResults = fuse.search(correctedQuery);
        results = [...results, ...altResults].filter((v, i, a) => 
            a.findIndex(t => t.item.id === v.item.id) === i
        );
    }
    
    if (results.length < 3) {
        const basicResults = fuse.search(originalQuery);
        results = [...results, ...basicResults].filter((v, i, a) => 
            a.findIndex(t => t.item.id === v.item.id) === i
        );
    }
    
    results = results.map(r => ({
        ...r.item,
        score: r.score,
        searchTerms: searchTerms
    }));
    
    results.forEach(result => {
        let bonusScore = 0;
        
        const questionLower = result.question.toLowerCase();
        const keywordsLower = result.keywords.toLowerCase();
        const answerLower = result.answer.replace(/<[^>]*>/g, '').toLowerCase();
        const combinedText = questionLower + ' ' + keywordsLower + ' ' + answerLower;
        
        if (questionLower.includes(originalQuery.toLowerCase())) {
            bonusScore -= 0.5;
        }
        if (keywordsLower.includes(originalQuery.toLowerCase())) {
            bonusScore -= 0.4;
        }
        
        searchTerms.forEach((term, index) => {
            const isImportantTerm = term.length > 4 || ['atem', 'deck', 'tv'].includes(term);
            const multiplier = isImportantTerm ? 1.5 : 1.0;
            const positionBonus = index === 0 ? 1.2 : 1.0;
            
            if (questionLower.includes(term)) {
                bonusScore -= 0.25 * multiplier * positionBonus;
            }
            if (keywordsLower.includes(term)) {
                bonusScore -= 0.2 * multiplier * positionBonus;
            }
            
            const answerMatches = (answerLower.match(new RegExp('\\b' + term + '\\b', 'g')) || []).length;
            bonusScore -= answerMatches * 0.04;
        });
        
        if (result.pinned) bonusScore -= 0.12;
        
        const allTermsInQuestion = searchTerms.every(term => questionLower.includes(term));
        if (allTermsInQuestion) bonusScore -= 0.4;
        
        const allTermsInKeywords = searchTerms.every(term => keywordsLower.includes(term));
        if (allTermsInKeywords) bonusScore -= 0.35;
        
        const allTermsInCombined = searchTerms.every(term => combinedText.includes(term));
        if (allTermsInCombined) bonusScore -= 0.2;
        
        const matchPercentage = searchTerms.filter(term => 
            questionLower.includes(term) || keywordsLower.includes(term)
        ).length / searchTerms.length;
        bonusScore -= matchPercentage * 0.2;
        
        const problemWords = ['no', 'not', 'won\'t', 'can\'t', 'broken', 'issue', 'problem', 'help'];
        const hasProblemWord = searchTerms.some(term => problemWords.includes(term));
        if (hasProblemWord && questionLower.match(/fix|troubleshoot|issue|problem/i)) {
            bonusScore -= 0.15;
        }
        
        const categoryBoosts = {
            'Setup/Shutdown': ['start', 'startup', 'shutdown', 'boot', 'turn', 'power'],
            'Audio': ['sound', 'audio', 'mic', 'mute', 'volume', 'hear'],
            'Video': ['camera', 'dark', 'bright', 'video', 'picture', 'tv', 'monitor'],
            'Networking': ['internet', 'ethernet', 'network', 'connection', 'stream', 'cache'],
            'Stream Deck': ['deck', 'button', 'companion'],
            'Software': ['quicktime', 'propresenter', 'displaylink', 'software']
        };
        
        Object.keys(categoryBoosts).forEach(cat => {
            if (result.category === cat) {
                const matchingTerms = searchTerms.filter(term => 
                    categoryBoosts[cat].some(boost => boost.includes(term) || term.includes(boost))
                );
                bonusScore -= matchingTerms.length * 0.1;
            }
        });
        
        result.score += bonusScore;
    });
    
    results.sort((a, b) => a.score - b.score);
    
    if (results.length < 2 || (results.length > 0 && results[0].score > 0.7)) {
        const relevantPinned = faqData.filter(f => f.pinned).map(f => ({
            ...f,
            searchTerms: searchTerms,
            score: 0.8
        }));
        results = [...results, ...relevantPinned].filter((v, i, a) => 
            a.findIndex(t => t.id === v.id) === i
        ).sort((a, b) => a.score - b.score);
    }
    
    return results;
}

let suggestionTimeout;
let currentSuggestionIndex = -1;

function showSuggestions(query) {
    clearTimeout(suggestionTimeout);
    
    if (!query || query.length < 2) {
        document.getElementById('suggestionsDropdown').classList.remove('active');
        return;
    }
    
    suggestionTimeout = setTimeout(() => {
        const results = intelligentSearch(query).slice(0, 5);
        const dropdown = document.getElementById('suggestionsDropdown');
        
        if (results.length === 0) {
            dropdown.classList.remove('active');
            return;
        }
        
        dropdown.innerHTML = results.map((faq, index) => {
            // Strip HTML and add spaces between elements for preview
            const cleanAnswer = faq.answer
                .replace(/<\/?(h3|ol|ul|li|p|strong)[^>]*>/gi, ' ')
                .replace(/<[^>]*>/g, '')
                .replace(/\s+/g, ' ')
                .trim();
            
            const preview = cleanAnswer.substring(0, 80) + '...';
            const highlightedQuestion = highlightText(faq.question, faq.searchTerms);
            
            return `
                <div class="suggestion-item" data-index="${index}" data-id="${faq.id}">
                    <div class="suggestion-question">${highlightedQuestion}</div>
                    <div class="suggestion-preview">${preview}</div>
                    <span class="suggestion-category">${faq.category}</span>
                </div>
            `;
        }).join('');
        
        dropdown.classList.add('active');
        
        dropdown.querySelectorAll('.suggestion-item').forEach(item => {
            item.addEventListener('click', () => {
                const faqId = parseInt(item.dataset.id);
                const faq = faqData.find(f => f.id === faqId);
                if (faq) {
                    document.getElementById('searchBar').value = faq.question;
                    currentSearch = faq.question;
                    saveRecentSearch(query);
                    renderAll();
                    dropdown.classList.remove('active');
                    
                    setTimeout(() => {
                        const faqElement = document.querySelector(`.faq-item[data-id="${faqId}"]`);
                        if (faqElement) {
                            faqElement.scrollIntoView({ behavior: 'smooth', block: 'center' });
                            faqElement.click();
                        }
                    }, 100);
                }
            });
        });
    }, 200);
}

let currentCategory = 'all';
let currentSearch = '';

function renderFAQ(faq, container) {
    const item = document.createElement('div');
    item.className = `faq-item ${faq.pinned ? 'pinned' : ''}`;
    item.dataset.id = faq.id;
    
    // Strip HTML and add spaces between elements for preview
    const cleanAnswer = faq.answer
        .replace(/<\/?(h3|ol|ul|li|p|strong)[^>]*>/gi, ' ')
        .replace(/<[^>]*>/g, '')
        .replace(/\s+/g, ' ')
        .trim();
    
    const preview = cleanAnswer.substring(0, 120) + '...';
    const highlightedQuestion = faq.searchTerms ? highlightText(faq.question, faq.searchTerms) : faq.question;
    const highlightedPreview = faq.searchTerms ? highlightText(preview, faq.searchTerms) : preview;
    
    item.innerHTML = `
        <div class="faq-question"><span>${highlightedQuestion}</span><span class="expand-icon">‚ñº</span></div>
        <span class="faq-category">${faq.category}</span>
        <div class="faq-preview">${highlightedPreview}</div>
        <div class="faq-answer">${faq.answer}</div>
    `;
    
    item.onclick = () => {
        const isExpanded = item.classList.contains('expanded');
        document.querySelectorAll('.faq-answer').forEach(a => a.classList.remove('expanded'));
        document.querySelectorAll('.faq-item').forEach(i => i.classList.remove('expanded'));
        if (!isExpanded) {
            item.classList.add('expanded');
            item.querySelector('.faq-answer').classList.add('expanded');
        }
    };
    
    container.appendChild(item);
}

function renderAll() {
    document.getElementById('pinnedList').innerHTML = '';
    document.getElementById('faqList').innerHTML = '';
    document.getElementById('suggestionsDropdown').classList.remove('active');
    
    let filtered = faqData;
    
    if (currentCategory !== 'all') {
        filtered = faqData.filter(f => f.category === currentCategory);
    }
    
    if (currentSearch) {
        filtered = intelligentSearch(currentSearch);
        document.getElementById('pinnedSection').style.display = 'none';
        
        if (filtered.length === 0) {
            document.getElementById('noResults').style.display = 'block';
            document.getElementById('faqList').style.display = 'none';
            document.getElementById('searchStats').textContent = '';
            return;
        } else {
            document.getElementById('noResults').style.display = 'none';
            document.getElementById('faqList').style.display = 'flex';
            document.getElementById('searchStats').textContent = `Found ${filtered.length} result${filtered.length !== 1 ? 's' : ''}`;
        }
        
        filtered.forEach(f => renderFAQ(f, document.getElementById('faqList')));
        
        saveRecentSearch(currentSearch);
    } else {
        document.getElementById('pinnedSection').style.display = 'block';
        document.getElementById('noResults').style.display = 'none';
        document.getElementById('faqList').style.display = 'flex';
        document.getElementById('searchStats').textContent = '';
        
        const pinned = filtered.filter(f => f.pinned);
        pinned.forEach(f => renderFAQ(f, document.getElementById('pinnedList')));
        filtered.filter(f => !f.pinned).forEach(f => renderFAQ(f, document.getElementById('faqList')));
    }
}

const searchBar = document.getElementById('searchBar');
const clearSearchBtn = document.getElementById('clearSearch');
const searchIcon = document.getElementById('searchIcon');

searchBar.addEventListener('input', e => {
    currentSearch = e.target.value.trim();
    
    if (e.target.value) {
        clearSearchBtn.classList.add('active');
        searchIcon.style.display = 'none';
    } else {
        clearSearchBtn.classList.remove('active');
        searchIcon.style.display = 'block';
    }
    
    showSuggestions(currentSearch);
    if (!currentSearch) renderAll();
});

searchBar.addEventListener('keydown', e => {
    if (e.key === 'Enter') {
        renderAll();
    }
});

clearSearchBtn.addEventListener('click', () => {
    searchBar.value = '';
    currentSearch = '';
    clearSearchBtn.classList.remove('active');
    searchIcon.style.display = 'block';
    renderAll();
    searchBar.focus();
});

document.addEventListener('click', e => {
    if (!e.target.closest('.search-container')) {
        document.getElementById('suggestionsDropdown').classList.remove('active');
    }
});

document.querySelectorAll('.category-btn').forEach(btn => btn.onclick = () => {
    document.querySelectorAll('.category-btn').forEach(b => b.classList.remove('active'));
    btn.classList.add('active');
    currentCategory = btn.dataset.category;
    document.getElementById('searchBar').value = '';
    currentSearch = '';
    renderAll();
});

document.getElementById('reportBtn').onclick = e => {
    e.preventDefault();
    document.getElementById('contactModal').style.display = 'block';
};

document.getElementById('cancelBtn').onclick = () => {
    document.getElementById('contactModal').style.display = 'none';
};

document.getElementById('contactForm').onsubmit = async e => {
    e.preventDefault();
    const res = await fetch(e.target.action, {
        method: 'POST',
        body: new FormData(e.target),
        headers: {'Accept': 'application/json'}
    });
    if (res.ok) {
        document.getElementById('contactForm').style.display = 'none';
        document.getElementById('successMessage').style.display = 'block';
        setTimeout(() => document.getElementById('contactModal').style.display = 'none', 3000);
    }
};

loadRecentSearches();
renderRecentSearches();
renderAll();
    </script>
</body>
</html>